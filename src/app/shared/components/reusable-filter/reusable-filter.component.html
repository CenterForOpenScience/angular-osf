@if (isLoading()) {
  <div class="flex-1 mt-4 md:mt-8 lg:pt-5">
    <osf-loading-spinner />
  </div>
} @else if (hasVisibleFilters()) {
  <div
    [ngClass]="{ 'border-1 grey-border-color border-round-xl px-4': !plainStyle() }"
    class="bg-white flex flex-column gap-2 filters"
  >
    <p-accordion (valueChange)="onAccordionToggle($event)">
      @for (filter of groupedFilters().individual; track filter.key) {
        <p-accordion-panel [value]="filter.key">
          <p-accordion-header>{{ getFilterLabel(filter) }}</p-accordion-header>
          <p-accordion-content>
            @if (filter.description) {
              <p class="text-sm text-gray-600 mb-3">{{ filter.description }}</p>
            }

            @if (filter.helpLink && filter.helpLinkText) {
              <p class="text-sm mb-3">
                <a
                  [href]="filter.helpLink"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="text-primary hover:underline"
                >
                  {{ filter.helpLinkText }}
                </a>
              </p>
            }

            @if (hasFilterContent(filter)) {
              <osf-generic-filter
                [options]="getFilterOptions(filter)"
                [searchResults]="getFilterSearchResults(filter)"
                [isPaginationLoading]="!!filter.isPaginationLoading"
                [isLoading]="!!filter.isLoading"
                [isSearchLoading]="!!filter.isSearchLoading"
                [selectedValue]="getSelectedValue(filter.key)"
                [placeholder]="getFilterPlaceholder(filter.key) | translate"
                [filterType]="filter.key"
                (valueChanged)="onFilterChanged(filter.key, $event)"
                (searchTextChanged)="onFilterSearch(filter.key, $event)"
                (loadMoreOptions)="onLoadMoreOptions(filter.key)"
              />
            } @else {
              <p class="text-sm text-gray-500">{{ 'collections.filters.noOptionsAvailable' | translate }}</p>
            }
          </p-accordion-content>
        </p-accordion-panel>
      }

      @for (group of groupedFilters().grouped; track group.key) {
        <p-accordion-panel [value]="group.key">
          <p-accordion-header>{{ group.label }}</p-accordion-header>
          <p-accordion-content>
            <div class="flex flex-column gap-2">
              @for (filter of group.filters; track filter.key) {
                <div class="flex align-items-center gap-2">
                  <p-checkbox
                    [binary]="true"
                    [ngModel]="Boolean(selectedValues()[filter.key])"
                    (onChange)="onCheckboxChange($event, filter)"
                    [inputId]="'checkbox-' + filter.key"
                  />
                  <label [for]="'checkbox-' + filter.key" class="cursor-pointer m-0">
                    {{ getFilterLabel(filter) }} ({{ filter.resultCount }})
                  </label>
                </div>
              }
            </div>
          </p-accordion-content>
        </p-accordion-panel>
      }
    </p-accordion>
  </div>
} @else if (showEmptyState()) {
  <div class="text-center text-gray-500 py-4">
    <p>{{ 'collections.filters.noFiltersAvailable' | translate }}</p>
  </div>
}
