@if (isLoading()) {
  <div class="flex-1 mt-4 md:mt-8 lg:pt-5">
    <osf-loading-spinner />
  </div>
} @else if (visibleFilters().length > 0) {
  <div
    [ngClass]="{ 'border-1 grey-border-color border-round-xl px-4': !plainStyle() }"
    class="bg-white flex flex-column gap-2 filters"
  >
    <p-accordion (valueChange)="onAccordionToggle(String($event))">
      @for (filter of splitFilters().individual; track filter.key) {
        <p-accordion-panel [value]="filter.key">
          <p-accordion-header>{{ filter.label || filter.key }}</p-accordion-header>
          <p-accordion-content>
            @if (filter.description) {
              <p class="mb-3">{{ filter.description }}</p>
            }

            @if (filter.helpLink && filter.helpLinkText) {
              <a [href]="filter.helpLink" class="block font-bold mb-3" target="_blank" rel="noopener noreferrer">
                {{ filter.helpLinkText }}
              </a>
            }

            <osf-generic-filter
              [filterOperator]="filter.operator"
              [placeholder]="FILTER_PLACEHOLDERS[filter.key] || '' | translate"
              [options]="filter.options || []"
              [selectedOptions]="selectedOptions()[filter.key] || []"
              [searchResults]="filterSearchResults()[filter.key] || []"
              [isPaginationLoading]="!!filter.isPaginationLoading"
              [isLoading]="!!filter.isLoading"
              [isSearchLoading]="!!filter.isSearchLoading"
              (selectedOptionsChanged)="onSelectedFilterOptionsChanged(filter, $event)"
              (searchTextChanged)="onSearchFilterOptions(filter, $event)"
              (loadMoreOptions)="onLoadMoreFilterOptions(filter)"
            />
          </p-accordion-content>
        </p-accordion-panel>
      }

      @if (splitFilters().grouped.length > 0) {
        <p-accordion-panel [value]="'is-present-group'">
          <p-accordion-header>{{ 'Additional Filters' }}</p-accordion-header>
          <p-accordion-content>
            <div class="flex flex-column gap-2">
              @for (filter of splitFilters().grouped; track filter.key) {
                <div class="flex align-items-center gap-2">
                  <!-- TODO fix - use selectedOptionValues for ngModel -->
                  <!-- TODO extract into the generic filter component -->
                  <p-checkbox
                    [binary]="true"
                    [ngModel]="Boolean(selectedOptions()[filter.key])"
                    (onChange)="onCheckboxChange($event, filter)"
                    [inputId]="'checkbox-' + filter.key"
                  />
                  <label [for]="'checkbox-' + filter.key" class="cursor-pointer m-0">
                    {{ filter.label || filter.key }} ({{ filter.resultCount }})
                  </label>
                </div>
              }
            </div>
          </p-accordion-content>
          <div [id]="`filter-${group.key}`"></div>
        </p-accordion-panel>
      }
    </p-accordion>
  </div>
} @else if (showEmptyState()) {
  <div class="text-center py-4">
    <p>{{ 'collections.filters.noFiltersAvailable' | translate }}</p>
  </div>
}
