<section class="account-setting">
  <h2 class="account-setting-header">Change Password</h2>

  <form [formGroup]="passwordForm" class="flex flex-column gap-3">
    <div class="flex flex-column gap-2 no-meter">
      <label for="old-password">Old password</label>
      <p-password
        [formControlName]="AccountSettingsPasswordFormControls.OldPassword"
        [toggleMask]="true"
        [ngClass]="{
          'ng-invalid ng-dirty':
            passwordForm.get(AccountSettingsPasswordFormControls.OldPassword)?.invalid &&
            passwordForm.get(AccountSettingsPasswordFormControls.OldPassword)?.touched,
        }"
      />
      @if (
        passwordForm.get(AccountSettingsPasswordFormControls.OldPassword)?.errors?.['required'] &&
        passwordForm.get(AccountSettingsPasswordFormControls.OldPassword)?.touched
      ) {
        <small class="text-red-500">Old password is required</small>
      }
    </div>

    <div class="flex flex-column gap-2 md:flex-row">
      <div class="flex flex-column flex-1 gap-2">
        <label for="new-password">New password</label>
        <p-password
          [formControlName]="AccountSettingsPasswordFormControls.NewPassword"
          [toggleMask]="true"
          [ngClass]="{
            'ng-invalid ng-dirty':
              (passwordForm.get(AccountSettingsPasswordFormControls.NewPassword)?.invalid ||
                passwordForm.errors?.['sameAsOldPassword']) &&
              passwordForm.get(AccountSettingsPasswordFormControls.NewPassword)?.touched,
          }"
        />
        <small class="password-help">
          Your password needs to be at least 8 characters long, include both lower- and upper-case characters, and have
          at least one number or special character
        </small>
        @if (
          passwordForm.get(AccountSettingsPasswordFormControls.NewPassword)?.errors?.['required'] &&
          passwordForm.get(AccountSettingsPasswordFormControls.NewPassword)?.touched
        ) {
          <small class="text-red-500">New password is required</small>
        }
        @if (
          passwordForm.errors?.['sameAsOldPassword'] &&
          passwordForm.get(AccountSettingsPasswordFormControls.NewPassword)?.touched
        ) {
          <small class="text-red-500">New password must be different from old password</small>
        }
      </div>

      <div class="flex flex-column flex-1 gap-2 no-meter">
        <label for="confirm-password">Confirm password</label>
        <p-password
          [formControlName]="AccountSettingsPasswordFormControls.ConfirmPassword"
          [toggleMask]="true"
          [ngClass]="{
            'ng-invalid ng-dirty':
              (passwordForm.errors?.['passwordMismatch'] ||
                passwordForm.get(AccountSettingsPasswordFormControls.ConfirmPassword)?.errors?.['required']) &&
              passwordForm.get(AccountSettingsPasswordFormControls.ConfirmPassword)?.touched,
          }"
        />
        @if (
          passwordForm.get(AccountSettingsPasswordFormControls.ConfirmPassword)?.errors?.['required'] &&
          passwordForm.get(AccountSettingsPasswordFormControls.ConfirmPassword)?.touched
        ) {
          <small class="text-red-500">Please confirm your password</small>
        }
        @if (
          passwordForm.errors?.['passwordMismatch'] &&
          passwordForm.get(AccountSettingsPasswordFormControls.ConfirmPassword)?.touched
        ) {
          <small class="text-red-500">Passwords do not match</small>
        }
      </div>
    </div>

    <div class="flex flex-column gap-2">
      @if (errorMessage()) {
        <small class="text-red-500">{{ errorMessage() }}</small>
      }
      <div class="account-setting-action">
        <p-button size="large" (click)="changePassword()" [disabled]="passwordForm.invalid"> Update </p-button>
      </div>
    </div>
  </form>
</section>
