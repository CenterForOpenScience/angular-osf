@if (!isRegistryLoading() && !isSubjectsLoading() && !isInstitutionsLoading() && !isSchemaBlocksLoading()) {
  <div
    class="flex flex-column justify-content-center flex-wrap md:flex-row md:justify-content-between md:align-items-center"
  >
    <osf-sub-header
      [title]="registry()!.title"
      [showButton]="isModeration"
      [buttonSeverity]="'success'"
      [buttonLabel]="'moderation.makeDecision.header' | translate"
      [isSubmitting]="areReviewActionsLoading()"
      (buttonClick)="handleOpenMakeDecisionDialog()"
    />

    @if (!registry()?.archiving && !registry()?.withdrawn) {
      <div class="pb-5 pl-4 ml-auto w-full md:pr-4">
        <osf-overview-toolbar [currentResource]="toolbarResource()" [showViewOnlyLinks]="false" [isAdmin]="true" />
      </div>
    }
  </div>
  @if (registry()?.archiving) {
    <div class="flex flex-column bg-white flex-1 p-4 gap-4">
      <osf-archiving-message [registration]="registry()!"></osf-archiving-message>
    </div>
  } @else if (registry()?.withdrawn) {
    <div class="flex flex-column bg-white flex-1 p-4 gap-4">
      <osf-withdrawn-message [registration]="registry()!"></osf-withdrawn-message>
    </div>
  } @else {
    <div class="flex flex-column bg-white flex-1 p-4 gap-4">
      <osf-data-resources
        [resourceId]="registry()?.id"
        [hasData]="registry()?.hasData"
        [hasAnalyticCode]="registry()?.hasAnalyticCode"
        [hasMaterials]="registry()?.hasMaterials"
        [hasPapers]="registry()?.hasPapers"
        [hasSupplements]="registry()?.hasSupplements"
      ></osf-data-resources>

      <div class="flex flex-column gap-4 xl:flex-row">
        <div class="left-section">
          <div class="flex flex-column gap-4 md:flex-row resource">
            <osf-registry-statuses [registry]="registry()"></osf-registry-statuses>
            <osf-registry-revisions
              [registry]="registry()"
              [selectedRevisionIndex]="selectedRevisionIndex()"
              (openRevision)="openRevision($event)"
              (updateRegistration)="onUpdateRegistration($event)"
              (continueUpdate)="onContinueUpdateRegistration($event)"
            >
            </osf-registry-revisions>
          </div>
          <div class="blocks-section p-4">
            @for (page of schemaBlocks(); track page.id) {
              <h2 class="mb-4 text-xl">{{ page.title }}</h2>

              @if (page.description) {
                <p class="mb-4">{{ page.description }}</p>
              }

              @if (page.sections?.length) {
                @for (section of page.sections; track section.id) {
                  <div class="mb-4">
                    <h3 class="mb-2">{{ section.title }}</h3>
                    @if (section.description) {
                      <p class="mb-4">{{ section.description }}</p>
                    }
                    @if (section.questions?.length) {
                      <osf-registration-blocks-data
                        [class.mb-4]="!$last"
                        [questions]="section.questions"
                        [reviewData]="schemaResponse()?.revisionResponses || {}"
                        [isOverviewPage]="true"
                        [updatedFields]="updatedFields()"
                      ></osf-registration-blocks-data>
                    }
                  </div>
                }
              } @else {
                @if (page.questions?.length) {
                  <osf-registration-blocks-data
                    [class.mb-4]="!$last"
                    [questions]="page.questions"
                    [reviewData]="schemaResponse()?.revisionResponses || {}"
                    [isOverviewPage]="true"
                    [updatedFields]="updatedFields()"
                  ></osf-registration-blocks-data>
                }
              }
            }
            <!-- @for (block of mappedSchemaBlocks(); track $index) {
              @if (block.type === 'file-input' && block.files) {
                <ul class="flex flex-column gap-4 ml-5">
                  @for (file of block.files; track $index) {
                    <li class="list-disc">
                      <a [routerLink]="['/files', file.id]">{{ file.name }}</a>
                    </li>
                  }
                </ul>
              } @else if (block.type === 'multi-select-input' && block.values) {
                <div class="flex flex-column gap-4 p-4">
                  @for (value of block.values; track $index) {
                    @if (value) {
                      <p class="text-no-transform">{{ value }}</p>
                    }
                  }
                </div>
              } @else if (block.type === 'page-heading' && block.value) {
                <h1 class="pb-4 text-no-transform" [class.mt-4]="$index !== 0">{{ block.value }}</h1>
              } @else if ((block.type === 'subsection-heading' || block.type === 'question-label') && block.value) {
                <h3 class="pb-4 text-no-transform">{{ block.value }}</h3>
              } @else if (block.value && block.value !== 'select-input-option') {
                <p class="pb-4 text-no-transform">{{ block.value }}</p>
              }
            } -->
          </div>
        </div>
        <div class="flex flex-column right-section p-4">
          <osf-resource-metadata
            [currentResource]="resourceOverview()"
            (customCitationUpdated)="onCustomCitationUpdated($event)"
            [canWrite]="true"
          />
        </div>
      </div>
    </div>
  }
} @else {
  <div class="flex-1">
    <osf-loading-spinner />
  </div>
}
