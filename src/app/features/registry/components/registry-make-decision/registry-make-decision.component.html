<div class="flex flex-column gap-4">
  @for (action of reviewActions(); track $index) {
    <p class="flex flex-wrap gap-1">
      @switch (action.toState) {
        @case (SubmissionReviewStatus.Pending) {
          <span class="capitalize">{{ 'moderation.submissionReview.submitted' | translate }}</span>
        }
        @case (SubmissionReviewStatus.Accepted) {
          <span class="capitalize">{{ 'moderation.submissionReview.accepted' | translate }}</span>
        }
        @case (SubmissionReviewStatus.PendingWithdrawal) {
          <span class="capitalize">{{ 'moderation.submissionReview.withdrawalRequested' | translate }}</span>
        }
      }
      <span>{{ action.dateModified | dateAgo }}</span>
      <span>{{ 'moderation.submissionReview.by' | translate }}</span>
      <span>{{ action.creator?.name }}</span>
      @if (embargoEndDate) {
        <span>{{ 'moderation.submissionReview.embargoEnding' | translate }}</span>
        <span>{{ embargoEndDate | date: 'shortDate' }}</span>
      }
    </p>
  }

  <form [formGroup]="requestForm" class="flex flex-column gap-3">
    @if (isPendingModeration || isPendingReview || isPendingWithdrawal) {
      <div class="flex flex-column gap-2">
        <div class="flex gap-2">
          <p-radioButton
            [formControlName]="ModerationDecisionFormControls.Action"
            inputId="accept-action"
            [value]="acceptValue"
          ></p-radioButton>
          <label for="accept-action" class="m-0 flex gap-2 flex-column">
            @if (isPendingReview) {
              <p class="font-bold">{{ 'moderation.makeDecision.acceptRequest' | translate }}</p>
              <p>{{ 'moderation.makeDecision.acceptRequestMessage' | translate }}</p>
            } @else if (isPendingWithdrawal) {
              <p class="font-bold">{{ 'moderation.makeDecision.acceptWithdrawal' | translate }}</p>
              <p>{{ 'moderation.makeDecision.acceptWithdrawalMessage' | translate }}</p>
            } @else {
              <p class="font-bold">{{ 'moderation.makeDecision.acceptUpdate' | translate }}</p>
              <p>{{ 'moderation.makeDecision.acceptUpdateMessage' | translate }}</p>
            }
          </label>
        </div>
        <div class="flex gap-2">
          <p-radioButton
            [formControlName]="ModerationDecisionFormControls.Action"
            inputId="reject-action"
            [value]="rejectValue"
          ></p-radioButton>
          <label for="reject-action" class="m-0 flex gap-2 flex-column">
            @if (isPendingReview) {
              <p class="font-bold">{{ 'moderation.makeDecision.rejectRequest' | translate }}</p>
              <p>{{ 'moderation.makeDecision.rejectRequestMessage' | translate }}</p>
            } @else if (isPendingWithdrawal) {
              <p class="font-bold">{{ 'moderation.makeDecision.rejectWithdrawal' | translate }}</p>
              <p>{{ 'moderation.makeDecision.rejectWithdrawalMessage' | translate }}</p>
            } @else {
              <p class="font-bold">{{ 'moderation.makeDecision.rejectUpdate' | translate }}</p>
              <p>{{ 'moderation.makeDecision.rejectUpdateMessage' | translate }}</p>
            }
          </label>
        </div>
      </div>

      <div class="flex gap-2">
        <textarea
          pTextarea
          [formControlName]="ModerationDecisionFormControls.Comment"
          [placeholder]="'moderation.makeDecision.remarksPlaceholder' | translate"
          [rows]="6"
          class="w-full mt-3"
        ></textarea>
      </div>
    } @else {
      <div class="flex flex-column gap-2">
        <div class="flex gap-2">
          <p-radioButton
            [formControlName]="ModerationDecisionFormControls.Action"
            [inputId]="ReviewActionTrigger.ForceWithdraw"
            [value]="ReviewActionTrigger.ForceWithdraw"
          ></p-radioButton>
          <label [for]="ReviewActionTrigger.ForceWithdraw" class="m-0 flex gap-2 flex-column">
            <p class="font-bold">{{ 'moderation.makeDecision.forceWithdraw' | translate }}</p>
            <p>{{ 'moderation.makeDecision.forceWithdrawMessage' | translate }}</p>
          </label>
        </div>
      </div>
      <div class="flex flex-column gap-2">
        <textarea
          pTextarea
          [formControlName]="ModerationDecisionFormControls.Comment"
          [placeholder]="'moderation.makeDecision.justificationPlaceholder' | translate"
          [rows]="6"
          class="w-full mt-3"
        ></textarea>
        @if (isCommentInvalid) {
          <p-message class="simple-variant flex mt-1" severity="error" variant="simple" size="small">
            {{ INPUT_VALIDATION_MESSAGES.required | translate }}
          </p-message>
        }
      </div>
    }

    <div class="flex pt-3 gap-3 justify-content-between">
      <p-button
        [label]="'common.buttons.cancel' | translate"
        severity="info"
        (click)="dialogRef.close(false)"
        [disabled]="isSubmitting()"
        class="btn-full-width"
      />
      <p-button
        [label]="'moderation.makeDecision.submitDecision' | translate"
        (click)="handleSubmission()"
        severity="success"
        [disabled]="!requestForm.valid || isSubmitting()"
        [loading]="isSubmitting()"
        class="btn-full-width"
      />
    </div>
  </form>
</div>
