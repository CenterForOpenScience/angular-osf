<div class="flex justify-content-between align-items-center p-3 border-bottom-1 surface-border">
  <div class="amount-section">
    <ng-content select="[slot=amount]"></ng-content>
  </div>

  <div class="filters-section flex align-items-center gap-2">
    <ng-content select="[slot=otherFilters]"></ng-content>

    <p-multiselect
      [options]="tableColumns()"
      [(ngModel)]="selectedColumns"
      (onChange)="onColumnSelectionChange($event.value)"
      optionLabel="header"
      [placeholder]="customizeLabel()"
      [showToggleAll]="false"
      [showClear]="false"
      [dropdownIcon]="'hidden'"
    >
      <ng-template let-values pTemplate="selectedItems">
        <div class="flex align-items-center gap-2">
          <i class="pi pi-table text-primary font-bold text-xl"></i>
          <span class="text-lg">{{ 'adminInstitutions.institutionUsers.customize' | translate }}</span>
        </div>
      </ng-template>
    </p-multiselect>

    @if (downloadLink()) {
      <a
        pButton
        [href]="downloadLink()"
        class="p-button p-button-outlined p-button-sm p-08 font-bold no-underline grey-border-color"
        target="_blank"
      >
        <i class="pi pi-download text-primary text-xl"></i>
      </a>
    }

    @if (reportsLink()) {
      <a
        pButton
        [href]="reportsLink()"
        class="p-button p-button-outlined p-button-sm p-08 font-bold no-underline grey-border-color"
        target="_blank"
      >
        <i class="pi pi-chart-pie text-primary text-xl"></i>
      </a>
    }
  </div>
</div>

<p-table
  [columns]="selectedColumnsComputed()"
  [value]="tableData()"
  [autoLayout]="true"
  [scrollable]="true"
  [sortMode]="'single'"
  (onSort)="onSort($event)"
  [sortField]="sortColumn()"
  [sortOrder]="currentSortOrder()"
  [customSort]="true"
  [resetPageOnSort]="false"
  [tableStyle]="{ 'min-width': '50rem' }"
>
  <ng-template #header let-columns>
    <tr>
      @for (col of columns; track col.field) {
        <th [pSortableColumn]="col.sortable ? col.field : null">
          <div class="flex align-items-center gap-2">
            <span>{{ col.header | translate }}</span>
            @if (col.sortable) {
              <p-sortIcon [field]="col.field"></p-sortIcon>
            }
          </div>
        </th>
      }
    </tr>
  </ng-template>

  <ng-template #body let-rowData let-columns="columns">
    <tr>
      @for (col of columns; track col.field) {
        <td class="relative">
          <div class="flex align-items-center hover-group">
            @if (col.isLink && isLink(rowData[col.field])) {
              <a
                [href]="getLinkUrl(rowData[col.field])"
                [target]="getLinkTarget(rowData[col.field], col)"
                class="text-primary no-underline hover:underline"
              >
                {{ getCellValue(rowData[col.field]) }}
              </a>
            } @else {
              {{ getCellValue(rowData[col.field]) }}
            }

            @if (col.showIcon) {
              <p-button
                class="cursor-pointer icon-button pl-3"
                [icon]="col.iconClass"
                iconPos="right"
                variant="text"
                severity="info"
                (click)="onIconClick(rowData, col)"
              />
            }
          </div>
        </td>
      }
    </tr>
  </ng-template>
</p-table>

@if (enablePagination() && totalCount() > pageSize()) {
  <div class="p-3">
    <osf-custom-paginator
      [first]="first()"
      [totalCount]="totalCount()"
      [rows]="pageSize()"
      (pageChanged)="onPageChange($event)"
    ></osf-custom-paginator>
  </div>
}
