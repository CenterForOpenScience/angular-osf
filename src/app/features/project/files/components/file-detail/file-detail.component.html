<osf-sub-header [isLoading]="file().isLoading" title="{{ file().data?.name }}" />

<div class="flex gap-4 bg-white flex-column h-full flex-1 p-4">
  <div class="flex align-items-center gap-2 back-navigation font-semibold">
    <i class="pi pi-angle-left text-base"></i>
    <a [routerLink]="['../']" class="font-semibold">
      {{ 'project.files.detail.backToList' | translate }}
    </a>
  </div>

  <div class="flex xs:flex-column sm:flex-column lg:flex-row gap-4 flex-1">
    @if (safeLink) {
      <iframe
        [src]="safeLink"
        (load)="isIframeLoading = false"
        [hidden]="isIframeLoading"
        width="60%"
        title="Rendering of document"
        scrolling="yes"
        marginheight="0"
        frameborder="0"
        allowfullscreen=""
      ></iframe>
    }
    @if (isIframeLoading) {
      <div class="spinner-container">
        <osf-loading-spinner></osf-loading-spinner>
      </div>
    }

    <div class="flex flex-column gap-4 flex-1">
      <osf-file-metadata></osf-file-metadata>
      <osf-project-metadata></osf-project-metadata>
    </div>
  </div>
</div>

<p-dialog
  [header]="'project.files.detail.editDialog.title' | translate"
  [modal]="true"
  [(visible)]="editFileMetadataVisible"
  [style]="{ width: '25rem' }"
>
  <form [formGroup]="fileMetadataForm" (ngSubmit)="setFileMetadata()" class="flex flex-column gap-3">
    <div class="flex flex-column gap-1">
      <p>{{ 'project.files.detail.fileMetadata.fields.title' | translate }}</p>
      <input pInputText id="title" formControlName="title" />
    </div>
    <div class="flex flex-column gap-1">
      <p>{{ 'project.files.detail.fileMetadata.fields.description' | translate }}</p>
      <input pInputText id="description" formControlName="description" />
    </div>
    <div class="flex flex-column gap-1">
      <p>{{ 'project.files.detail.fileMetadata.fields.resourceType' | translate }}</p>
      <p-select
        class="w-full"
        [options]="resourceTypes"
        optionValue="value"
        optionLabel="value"
        appendTo="body"
        formControlName="resourceType"
        [showClear]="true"
      ></p-select>
    </div>
    <div class="flex flex-column gap-1">
      <p>{{ 'project.files.detail.fileMetadata.fields.resourceLanguage' | translate }}</p>
      <p-select
        class="w-full"
        [options]="languages"
        optionValue="value"
        optionLabel="label"
        appendTo="body"
        formControlName="resourceLanguage"
        [showClear]="true"
      ></p-select>
    </div>

    <div class="flex btn-full-width gap-2">
      <p-button
        [label]="'project.files.detail.editDialog.buttons.cancel' | translate"
        severity="info"
        class="w-full"
        (click)="editFileMetadataVisible = false"
        type="button"
      />
      <p-button
        [label]="'project.files.detail.editDialog.buttons.save' | translate"
        class="w-full"
        type="submit"
        [disabled]="!fileMetadataForm.valid"
      />
    </div>
  </form>
</p-dialog>
