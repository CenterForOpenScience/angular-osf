<h2>Consent to publish</h2>
<p class="m-t-12">
  By submitting this preprint you confirm that all contributors agree with sharing it and that you have the right to
  share this preprint.
</p>
<p>
  {{ provider()?.name }} uses {{ provider()?.reviewsWorkflow }}. If your preprint is accepted, it will be assigned a DOI
  and become publicly accessible via OSF. The preprint file cannot be deleted but it can be updated or modified.
</p>
<p>
  You can read more about
  <a href="https://help.osf.io/article/592-preprint-moderation">OSF preprints moderation policies</a> on the OSF support
  center.
</p>

<p-card styleClass="m-t-24" class="card">
  <div class="flex flex-column gap-4">
    <h2>Title and Abstract</h2>

    <section class="flex flex-column gap-2">
      <h3>{{ provider()?.preprintWord | titlecase }} Service</h3>
      <div class="flex flex-row gap-2 align-items-center">
        <img [src]="provider()?.squareColorNoTransparentImageUrl" alt="Provider logo" height="36" width="36" />
        <p>{{ provider()?.name }}</p>
      </div>
    </section>

    <section class="flex flex-column gap-2">
      <h3>Title</h3>
      <p>{{ createdPreprint()!.title }}</p>
    </section>

    <section class="flex flex-column gap-2">
      <h3>Abstract</h3>
      <osf-truncated-text [maxVisibleLines]="2" [text]="createdPreprint()!.description" />
    </section>
  </div>
</p-card>

<p-card styleClass="m-t-24" class="card">
  <div class="flex flex-column gap-4">
    <h2>Metadata</h2>

    <section class="flex flex-column gap-2">
      <h3>Contributors</h3>

      <div class="flex gap-1 line-height-2">
        @for (contributor of bibliographicContributors(); track contributor.id) {
          <div>
            <a class="font-bold"> {{ contributor.fullName }}</a>
            <span>{{ $last ? '' : ',' }}</span>
          </div>
        }
      </div>
    </section>

    @if (affiliatedInstitutions().length) {
      <section class="flex flex-column gap-2">
        <h3>Affiliated Institutions</h3>

        <div class="flex gap-2">
          @for (institution of affiliatedInstitutions(); track institution.id) {
            <img alt="Institution logo" [src]="institution.assets.logo" height="45" />
          }
        </div>
      </section>
    }

    <section class="flex flex-column gap-2">
      <h3>License</h3>

      <div>{{ license()?.name }}</div>
    </section>

    <section class="flex flex-column gap-2">
      <h3>Publication DOI</h3>

      <a [href]="'https://doi.org/' + createdPreprint()?.doi">
        {{ 'https://doi.org/' + createdPreprint()?.doi }}
      </a>
    </section>

    <section class="flex flex-column gap-2">
      <h3>Subjects</h3>

      <div class="flex flex-wrap gap-2">
        @for (subject of subjects(); track subject.id) {
          <p-tag [value]="subject.name" severity="info" />
        }
      </div>
    </section>

    <section class="flex flex-column gap-2">
      <h3>Tags</h3>

      <div class="flex flex-wrap gap-2">
        @for (tag of createdPreprint()?.tags; track tag) {
          <p-tag [value]="tag" severity="info" />
        } @empty {
          <p>None</p>
        }
      </div>
    </section>

    <section class="flex flex-column gap-2">
      <h3>Publication Date</h3>

      @if (createdPreprint()?.originalPublicationDate) {
        {{ createdPreprint()?.originalPublicationDate | date: 'MMM d, y, h:mm a' }}
      } @else {
        <p>Not Applicable</p>
      }
    </section>

    <section class="flex flex-column gap-2">
      <h3>Publication Citation</h3>

      @if (createdPreprint()?.customPublicationCitation) {
        {{ createdPreprint()?.customPublicationCitation }}
      } @else {
        <p>Not Applicable</p>
      }
    </section>
  </div>
</p-card>

@if (provider()?.assertionsEnabled) {
  <p-card styleClass="m-t-24" class="card">
    <div class="flex flex-column gap-4">
      <h2>Author Assertions</h2>

      <section class="flex flex-column gap-2">
        <h3>Conflict of Interest</h3>

        @if (!createdPreprint()?.hasCoi) {
          <p>Author asserted no Conflict of Interest.</p>
        } @else {
          {{ createdPreprint()?.coiStatement }}
        }
      </section>

      <section class="flex flex-column gap-2">
        <h3>Public Data</h3>

        @switch (createdPreprint()?.hasDataLinks) {
          @case (ApplicabilityStatus.NotApplicable) {
            <p>Author asserted there is no data associated with this preprint.</p>
          }
          @case (ApplicabilityStatus.Unavailable) {
            {{ createdPreprint()?.whyNoData }}
          }
          @case (ApplicabilityStatus.Applicable) {
            @for (link of createdPreprint()?.dataLinks; track $index) {
              <p>{{ link }}</p>
            }
          }
        }
      </section>

      <section class="flex flex-column gap-2">
        <h3>Public Preregistration</h3>

        @switch (createdPreprint()?.hasPreregLinks) {
          @case (ApplicabilityStatus.NotApplicable) {
            <p>
              The author asserts that a preregistration is not applicable because no data collection, extraction, or
              analysis is reported in the preprint.
            </p>
          }
          @case (ApplicabilityStatus.Unavailable) {
            {{ createdPreprint()?.whyNoPrereg }}
          }
          @case (ApplicabilityStatus.Applicable) {
            @switch (createdPreprint()?.preregLinkInfo) {
              @case (PreregLinkInfo.Analysis) {
                <p>Analysis</p>
              }
              @case (PreregLinkInfo.Designs) {
                <p>Study Design</p>
              }
              @case (PreregLinkInfo.Both) {
                <p>Both</p>
              }
            }
            @for (link of createdPreprint()?.preregLinks; track $index) {
              <p>{{ link }}</p>
            }
          }
        }
      </section>
    </div>
  </p-card>
}

<p-card styleClass="m-t-24" class="card">
  <div class="flex flex-column gap-4">
    <h2>Supplements (Optional)</h2>
    @if (preprintProject()) {
      <p>{{ preprintProject()?.name }}</p>
    } @else {
      <p>Author did not add any supplements for this preprint</p>
    }
  </div>
</p-card>

<section class="m-t-48 flex flex-row justify-content-end align-items-center gap-2">
  <p-button class="w-6 md:w-6rem" styleClass="w-full" label="Cancel" severity="info" />
  <p-button class="w-6 md:w-9rem" styleClass="w-full" label="Submit" (click)="submitPreprint()" />
</section>
