@let action = currentReviewAction();
@let attributes = currentSubmissionAttributes();

@if (action && attributes) {
  <div class="resource">
    <p-accordion (onOpen)="handleOpen()">
      <p-accordion-panel value="0">
        <p-accordion-header class="flex flex-row align-items-start gap-3 p-3">
          <div osfStopPropagation class="flex align-items-baseline gap-2 font-normal">
            <div class="p-3">
              <div class="flex align-items-center gap-2">
                <osf-icon
                  [class]="reviewStatusIcon[submission().reviewsState].value"
                  [iconClass]="reviewStatusIcon[submission().reviewsState].icon"
                ></osf-icon>

                <p-button
                  class="link-btn-no-padding"
                  link
                  (onClick)="handleNavigation()"
                  [label]="submission().title"
                />
              </div>

              <p class="flex flex-wrap gap-1 mt-2">
                @switch (action.toState) {
                  @case (SubmissionReviewStatus.Pending) {
                    <span class="capitalize">{{ 'moderation.submissionReview.submitted' | translate }}</span>
                  }
                  @case (SubmissionReviewStatus.Accepted) {
                    @if (!collectionProvider()?.reviewsWorkflow) {
                      <span class="capitalize">{{ 'moderation.submissionReview.submitted' | translate }}</span>
                    } @else {
                      <span class="capitalize">{{ 'moderation.submissionReview.accepted' | translate }}</span>
                    }
                  }
                  @case (SubmissionReviewStatus.Rejected) {
                    <span class="capitalize">{{ 'moderation.submissionReview.rejected' | translate }}</span>
                  }
                  @case (SubmissionReviewStatus.Removed) {
                    <span class="capitalize">{{ 'moderation.submissionReview.withdrawn' | translate }}</span>
                  }
                }
                <span>{{ action.dateCreated | dateAgo }}</span>
                <span>{{ 'moderation.submissionReview.by' | translate }}</span>
                <span>{{ action.createdBy }}</span>
              </p>

              <div class="flex mt-2 flex-wrap">
                @for (attribute of attributes; track attribute.key) {
                  @if (!$first) {
                    <span class="mx-1 flex align-items-start">|</span>
                  }
                  <p class="font-normal">
                    <span class="font-bold">test {{ attribute.label }}:</span> {{ attribute.value }}
                  </p>
                }
              </div>

              @if (action.comment) {
                <osf-truncated-text class="block font-italic mt-2" [text]="action.comment" />
              }
            </div>
          </div>
        </p-accordion-header>

        <p-accordion-content>
          <div class="flex align-content-start gap-1 p-3 pt-0 ml-3">
            <p>{{ 'common.labels.contributors' | translate }}:</p>
            <osf-contributors-list
              [contributors]="submission().contributors!"
              [isLoading]="!!submission().contributorsLoading"
              [hasLoadMore]="hasMoreContributors()"
              (loadMoreContributors)="loadMoreContributors.emit()"
            >
            </osf-contributors-list>
          </div>
        </p-accordion-content>
      </p-accordion-panel>
    </p-accordion>
  </div>
}
